(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{418:function(a,e,t){"use strict";t.r(e);var s=t(17),i=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"批量发单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#批量发单"}},[a._v("#")]),a._v(" 批量发单")]),a._v(" "),t("p",[a._v("通过 "),t("code",[a._v("droplet-client")]),a._v(" 批量发布离线订单。")]),a._v(" "),t("p",[a._v("批量发单命令："),t("code",[a._v("droplet-clientstorage deals batch [command options] [miners price duration]")]),a._v("，具体使用和发送单个订单类似，新增了一些 Option。")]),a._v(" "),t("p",[a._v("部分 Option:")]),a._v(" "),t("ul",[t("li",[a._v("--miner 接收订单的矿工，可以是多个 "),t("code",[a._v("--miner=t010001")]),a._v(" "),t("code",[a._v("--miner=t010002")]),a._v("，多个会平均分配订单。")]),a._v(" "),t("li",[a._v("--manifest "),t("code",[a._v("go-graphsplit")]),a._v(" 生成的 "),t("code",[a._v("manifest.csv")]),a._v(" 文件，包含 "),t("code",[a._v("payload cid")]),a._v("、"),t("code",[a._v("piece cid")]),a._v(" 和 "),t("code",[a._v("piece size")]),a._v(" 等信息")]),a._v(" "),t("li",[a._v("--start-index 从 "),t("code",[a._v("manifest.csv")]),a._v(" 第 N 条订单开始")]),a._v(" "),t("li",[a._v("--end-index 在 "),t("code",[a._v("manifest.csv")]),a._v(" 第 N 条订单结束，start-index - end-index 就是本次预期发布的订单总数")]),a._v(" "),t("li",[a._v("--filter 是否启动过滤，默认是 false，目前有两条过滤规则\n"),t("ul",[t("li",[a._v("存储提供者重复的数据不能超过20%")]),a._v(" "),t("li",[a._v("一个发单者对同一个存储提供者发的datacap订单不能超过25%")])])])]),a._v(" "),t("h2",{attrs:{id:"例子"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[a._v("#")]),a._v(" 例子")]),a._v(" "),t("h3",{attrs:{id:"准备订单数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备订单数据"}},[a._v("#")]),a._v(" 准备订单数据")]),a._v(" "),t("p",[a._v("使用 "),t("a",{attrs:{href:"https://github.com/filedrive-team/go-graphsplit#usage",target:"_blank",rel:"noopener noreferrer"}},[a._v("go-graphsplit"),t("OutboundLink")],1),a._v(" 生成订单数据，"),t("code",[a._v("go-graphsplit")]),a._v(" 是一种用于将大型数据集分割成固定大小的 car 文件的工具。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# --car-dir 指定文件目录存储生成的 car 文件和 manifest.csv 文件\n# --slice-size 指定car文件大小\n# --graph-name 图的名字，可随意填\n# --calc-commp 是否计算 commp，必须要计算，离线订单需要piece cid 和 piece size\n# --rename 生成的car文件默认是以 payloadcid.car 作为文件名，加上本 flag 后以 piececid 作为文件名，建议加上本flag，方便后面数据导入\n# path-to-source-file 指定用于生成car文件的原始数据\n\n./graphsplit chunk --car-dir <car-dir> --slice-size <piece-size> --graph-name <name> --calc-commp --rename <path-to-source-file>\n\n# 结果\n会在指定的目录生成 car 文件和 manifest.csv 文件\n")])])]),t("p",[a._v("manifest.csv 文件内容，发单的时候会使用到 playload_cid、piece_cid、payload_size 和 payload_size。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('playload_cid,filename,piece_cid,payload_size,payload_size,detail\nbafybeib6kembdoggfwssslpcrxgpbhxmeyretwcnaspx5ff2r4rybt73gq,test-total-19-part-1.car,baga6ea4seaqevygou3u5mlxl6prwifaw2n4e6eanrbdl7wm2guzfm2r5tool4fi,14241759,16646144,"{""Name"":"""",""Hash"":""bafybeib6kembdoggfwssslpcrxgpbhxmeyretwcnaspx5ff2r4rybt73gq"",""Size"":0,""Link"":[{""Name"":""filecoin-ffi"",""Hash"":""bafybeibum5nzwz54733lioyzwhqrod2zauax2jaa4qiu5hdqw7fidzl47m"",""Size"":14240979,""Link"":[{""Name"":""libfilcrypto.a.00000001"",""Hash"":""bafybeigptobclymvmmlxn4n764dey2p6hgot6h34vtte5fzm67l2znwz4q"",""Size"":14240905,""Link"":null}]}]}"\nbafybeihh6sq3w5qmzrxakde5wwjkw7wnbwwxm5yvfo3nd5zjw25vtgcqom,test-total-19-part-2.car,baga6ea4seaqh4vblymafqc3tskmy5jilgs462gsbvuu6mxnsql364bhbj5omcji,14241759,16646144,"{""Name"":"""",""Hash"":""bafybeihh6sq3w5qmzrxakde5wwjkw7wnbwwxm5yvfo3nd5zjw25vtgcqom"",""Size"":0,""Link"":[{""Name"":""filecoin-ffi"",""Hash"":""bafybeigiprvgstre4ctcwleocm2gg52hzc32ccnjr66phud5qrnbmjyqli"",""Size"":14240979,""Link"":[{""Name"":""libfilcrypto.a.00000002"",""Hash"":""bafybeia4fxflzrihwbjkjayasrtvmnocvq5xn3pesendcjnlog47fchd6q"",""Size"":14240905,""Link"":null}]}]}"\nbafybeihw7afqagfvg2uhmigyunsgvxeidaqfbg6odi4jwbus6557kqhsd4,test-total-19-part-3.car,baga6ea4seaqij5nrrmypz22lchdrjcaowjdjk67agjntbcfbcbbrcrnrdbn7kfy,14241759,16646144,"{""Name"":"""",""Hash"":""bafybeihw7afqagfvg2uhmigyunsgvxeidaqfbg6odi4jwbus6557kqhsd4"",""Size"":0,""Link"":[{""Name"":""filecoin-ffi"",""Hash"":""bafybeicn4bdznskvsjt3on2633mm3uh5gungf37hmfhsizraugq4uleosu"",""Size"":14240979,""Link"":[{""Name"":""libfilcrypto.a.00000003"",""Hash"":""bafybeidi5kz5hhfwcqechj4czbyat3tlyyd4d6rigigkks66ysjy5agfke"",""Size"":14240905,""Link"":null}]}]}"\nbafybeigq66gjr6c6junro7t4fwcpkhl7vpowi3soadksjvleusq6nlzu6a,test-total-19-part-4.car,baga6ea4seaqaamzryns5cphp5bynuq5nrxdltxzcj6hoybboduhh4377rw6lqgy,14241759,16646144,"{""Name"":"""",""Hash"":""bafybeigq66gjr6c6junro7t4fwcpkhl7vpowi3soadksjvleusq6nlzu6a"",""Size"":0,""Link"":[{""Name"":""filecoin-ffi"",""Hash"":""bafybeih5lopymib4lbnoonqatu43r2avm2rw2nz4eeva6zmnyyegjsoyma"",""Size"":14240979,""Link"":[{""Name"":""libfilcrypto.a.00000004"",""Hash"":""bafybeieo2dahkmiak4rlyfehpgu4gyjq2v6wulbmcobha3f2nk6ftysaae"",""Size"":14240905,""Link"":null}]}]}"\n')])])]),t("h3",{attrs:{id:"批量发单-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#批量发单-2"}},[a._v("#")]),a._v(" 批量发单")]),a._v(" "),t("ol",[t("li",[a._v("发布普通离线订单")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals batch --from <address> --manifest <path-to-manifest.csv> --end-index 10 --start-index 5 --miner=t019150 --miner=t018682 0 518400\n\n# 结果\nhas 5 deals need to publish, t018682: 3, t019150: 2\ncreate deal success, proposal cid: bafyreihwvsr3vfsdbrxagtdjzsemngtc3r3xra2gaunbs6pjb63lyodl6a\ncreate deal success, proposal cid: bafyreid2oakcs2di6lq5mv3e4h5sybkezl3zn7lhvf656zeqentcsqetem\ncreate deal success, proposal cid: bafyreidmzdh7zee7inm65cdxmuwyxyv7uwtoo2hiphsjfseyymoir2z4nm\ncreate deal success, proposal cid: bafyreigt663jymtilnxocfybs27w6b564yxfczdpsx47fbsqwzrj54zxz4\ncreate deal success, proposal cid: bafyreigtemnxftqg65gtwsw3rwfvqaqzbb47d4r75ipksjlypcs56y7qei\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("批量发布 datacap 订单")])]),a._v(" "),t("blockquote",[t("p",[a._v("请加上 --verified-deal flag")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals batch --from <address> --manifest <path-to-manifest.csv> --end-index 15 --start-index 10 --verified-deal --miner=t019150 --miner=t018682 0 518400\n")])])]),t("h3",{attrs:{id:"查询订单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询订单"}},[a._v("#")]),a._v(" 查询订单")]),a._v(" "),t("ol",[t("li",[a._v("查询单个订单")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals get bafyreify4mm46vfdqsogcfhki44vi3ll5n2h35p5fflcclew53fgm3yieu\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("列出所有离线订单")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals list --offline\n")])])]),t("h3",{attrs:{id:"批量导入订单数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#批量导入订单数据"}},[a._v("#")]),a._v(" 批量导入订单数据")]),a._v(" "),t("p",[t("strong",[a._v("前提：使用 "),t("code",[a._v("go-graphsplit")]),a._v(" 生成的 car 文件是以 piececid 作为文件名。")])]),a._v(" "),t("ol",[t("li",[a._v("导出待导入的离线订单")])]),a._v(" "),t("p",[a._v("可以导出所有订单状态在 "),t("code",[a._v("StorageDealWaitingForData")]),a._v(" 的订单，导出数据包括 proposal cid 和 piece cid。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals export --output proposal_piece.txt\n\ncat proposal_piece.txt\n\nproposalCID,pieceCID\nbafyreihwvsr3vfsdbrxagtdjzsemngtc3r3xra2gaunbs6pjb63lyodl6a,baga6ea4seaqbj3yywnq3yisdxy4zlf4if2whlm5sdjcz7ricm2wrow2b7rc2uja\nbafyreid2oakcs2di6lq5mv3e4h5sybkezl3zn7lhvf656zeqentcsqetem,baga6ea4seaqcdstiui27aajpz2dcpx2f6brimxhfvepgxljwsweicul32pkeofq\nbafyreidmzdh7zee7inm65cdxmuwyxyv7uwtoo2hiphsjfseyymoir2z4nm,baga6ea4seaqlrwtnhj322vczuuiy2ekb4kjftbf3ho6f4bgy6k5rnzh67eia4lq\nbafyreigt663jymtilnxocfybs27w6b564yxfczdpsx47fbsqwzrj54zxz4,baga6ea4seaqdgfsfsdtpnsgwlwhtj4ecvk7432gaqheltfrzun3vju3yc3d7cnq\nbafyreigtemnxftqg65gtwsw3rwfvqaqzbb47d4r75ipksjlypcs56y7qei,\nbaga6ea4seaqknn4cstmtmscdhebaxmv5dopnxqthwbdmvuslbuv5dcupzvw46ni\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("批量导入订单数据")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# --cardir car 文件的目录，若提前把 car 文件放到 piecestore，则本 flag 可以省略，如果确认piece数据没有问题，可以使用 `--skip-commp` 参数来加速数据导入过程。\n./droplet storage deal batch-import-data --manifest <proposal_piece.txt> --cardir <path-to-cardir>\n\n# 结果\nimport data success: bafyreihwvsr3vfsdbrxagtdjzsemngtc3r3xra2gaunbs6pjb63lyodl6a\nimport data success: bafyreid2oakcs2di6lq5mv3e4h5sybkezl3zn7lhvf656zeqentcsqetem\nimport data success: bafyreidmzdh7zee7inm65cdxmuwyxyv7uwtoo2hiphsjfseyymoir2z4nm\nimport data success: bafyreigt663jymtilnxocfybs27w6b564yxfczdpsx47fbsqwzrj54zxz4\nimport data success: bafyreigtemnxftqg65gtwsw3rwfvqaqzbb47d4r75ipksjlypcs56y7qei\n")])])]),t("h3",{attrs:{id:"查询占比情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询占比情况"}},[a._v("#")]),a._v(" 查询占比情况")]),a._v(" "),t("ol",[t("li",[a._v("查看存储提供者订单重复情况")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals verified-deal-stat --provider t019150\n\n# 结果\nProvider  Total      Uniq       DuplicationPercentage  \nt019150   981467136  612368384  37.61% \n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("查看样本分布情况")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("./droplet-client storage deals verified-deal-stat --client t3wivhkdivcxj5zp2l4wjkzon232s52smnd5m3na66ujl5nel75jggguhgaa3zbhjo3as4epf5ytxl6ly3qoha\n\n# 结果\nClient: t3wivhkdivcxj5zp2l4wjkzon232s52smnd5m3na66ujl5nel75jggguhgaa3zbhjo3as4epf5ytxl6ly3qoha\nTotal:  16.17 GiB / 17362337792 B\nUniq:   14.77 GiB / 15860764672 B\nDuplicationPercentage: 8.65%\nProvider  Total                      Percentage  Uniq                       DuplicationPercentage  \nt019150   620 MiB / 650117120 B      3.74%       620 MiB / 650117120 B      0.00%                  \nt018682   15.56 GiB / 16712220672 B  96.26%      14.42 GiB / 15487471616 B  7.33%  \n")])])])])}),[],!1,null,null,null);e.default=i.exports}}]);