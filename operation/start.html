<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started | Droplet</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/droplet-icon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-GRVZ8072DQ"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-GRVZ8072DQ');</script>
    <meta name="description" content="Droplet, formerly known as Venus Deal Service, is THE Filecoin storage deal solution.">
    
    <link rel="preload" href="/assets/css/0.styles.72e9161a.css" as="style"><link rel="preload" href="/assets/js/app.22e6f3d6.js" as="script"><link rel="preload" href="/assets/js/2.d646fae5.js" as="script"><link rel="preload" href="/assets/js/20.e55ae312.js" as="script"><link rel="prefetch" href="/assets/js/10.54d869d8.js"><link rel="prefetch" href="/assets/js/11.0709d827.js"><link rel="prefetch" href="/assets/js/12.1067bf79.js"><link rel="prefetch" href="/assets/js/13.79dca4c5.js"><link rel="prefetch" href="/assets/js/14.ccd12171.js"><link rel="prefetch" href="/assets/js/15.cfd4f0ef.js"><link rel="prefetch" href="/assets/js/16.0655211a.js"><link rel="prefetch" href="/assets/js/17.b592e31e.js"><link rel="prefetch" href="/assets/js/18.dd25ebca.js"><link rel="prefetch" href="/assets/js/19.ae250042.js"><link rel="prefetch" href="/assets/js/21.8ec14afd.js"><link rel="prefetch" href="/assets/js/22.20cd45db.js"><link rel="prefetch" href="/assets/js/23.b96f8066.js"><link rel="prefetch" href="/assets/js/24.98c32c85.js"><link rel="prefetch" href="/assets/js/25.bc845610.js"><link rel="prefetch" href="/assets/js/26.c6900ae9.js"><link rel="prefetch" href="/assets/js/27.40422914.js"><link rel="prefetch" href="/assets/js/28.308f449b.js"><link rel="prefetch" href="/assets/js/29.dc474eae.js"><link rel="prefetch" href="/assets/js/3.4f172ebf.js"><link rel="prefetch" href="/assets/js/30.f033c8be.js"><link rel="prefetch" href="/assets/js/31.4d803608.js"><link rel="prefetch" href="/assets/js/32.195b1e04.js"><link rel="prefetch" href="/assets/js/33.e36813ef.js"><link rel="prefetch" href="/assets/js/34.31db2e2c.js"><link rel="prefetch" href="/assets/js/35.48bf0c09.js"><link rel="prefetch" href="/assets/js/36.5e631563.js"><link rel="prefetch" href="/assets/js/37.268ad578.js"><link rel="prefetch" href="/assets/js/38.29313c11.js"><link rel="prefetch" href="/assets/js/39.6ffc3ac2.js"><link rel="prefetch" href="/assets/js/4.ee54e947.js"><link rel="prefetch" href="/assets/js/40.eb08e8b4.js"><link rel="prefetch" href="/assets/js/41.f90b1bb5.js"><link rel="prefetch" href="/assets/js/5.b5bd5abf.js"><link rel="prefetch" href="/assets/js/6.0c2827f1.js"><link rel="prefetch" href="/assets/js/7.fc8c7bc4.js"><link rel="prefetch" href="/assets/js/8.9147db7e.js"><link rel="prefetch" href="/assets/js/9.5a86ab25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.72e9161a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/droplet-icon.png" alt="Droplet" class="logo"> <span class="site-name can-hide">Droplet</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Deployment &amp; Operations
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Deployment &amp; Operations
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/start.html" aria-current="page" class="active sidebar-link">Getting started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operation/start.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#configure-and-start-droplet" class="sidebar-link">Configure and Start droplet</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#droplet-proxy-libp2p-listener" class="sidebar-link">droplet proxy libp2p listener</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#storage-ask" class="sidebar-link">Storage Ask</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#configure-and-start-droplet-client" class="sidebar-link">Configure and Start droplet-client</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#storage-deal" class="sidebar-link">Storage Deal</a></li><li class="sidebar-sub-header"><a href="/operation/start.html#submit-data-retrieval-request" class="sidebar-link">Submit Data Retrieval Request</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Configurations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/market-config.html" class="sidebar-link">Droplet config</a></li><li><a href="/operation/client-config.html" class="sidebar-link">Client config</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Operations</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/prep-datasets.html" class="sidebar-link">Preping large datasets</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Migration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/migrate-v1-to-v2.html" class="sidebar-link">Upgrading to droplet 2.x</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h1> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p><code>droplet</code> is the market service component in the <code>venus</code> system, which consists of two parts: <code>droplet</code> and <code>droplet-client</code>, commonly understood as market server and client.</p> <ul><li><p><code>droplet</code> serves storage providers;</p></li> <li><p><code>droplet-client</code> serves users who have retrieval or storage demands.</p></li></ul> <p>The market service of <code>droplet</code> is divided into storage market and retrieval market, and its general process is as follows:</p> <p>Storage process:</p> <table><thead><tr><th>Stages</th> <th>Steps</th> <th>Instructions</th></tr></thead> <tbody><tr><td>Start <code>droplet</code> and <code>droplet-client</code></td> <td>1. Configure and start [droplet](#Configure and Start droplet) <br> 2. Configure and start [droplet-client](#Configure and Start droplet-client)</td> <td></td></tr> <tr><td>Proxy <code>libp2p</code> listener service for <code>miners</code></td> <td>via <code>droplet</code> [<code>libp2p</code> listener service for <code>miners</code>](#droplet proxy libp2p listener)</td> <td></td></tr> <tr><td>Post storage ask for <code>miners</code></td> <td>via <code>droplet</code> <a href="#ask">ask</a></td> <td></td></tr> <tr><td>Specify <code>miner</code> to propose deal</td> <td>1. Through <code>droplet-client</code> [import the data to be stored](#import the data to be stored) <br> 2. According to the demand [select the appropriate storage provider](#select the storage provider) &lt; br&gt; 3. [Initiate storage deal](#Initiate storage deal)</td> <td>After the deal is issued, it takes a certain amount of time to execute the deal transaction process. After the deal is confirmed, the storage provider seal the data in the deal and submits the certificate. <code>droplet</code> will be responsible for tracking order status.</td></tr></tbody></table> <p>Retrieval process:</p> <table><thead><tr><th>Stages</th> <th>Steps</th> <th>Instructions</th></tr></thead> <tbody><tr><td>Start <code>droplet</code> and <code>droplet-client</code></td> <td>1. Configure and start [droplet](#Configure and Start droplet) <br> 2. Configure and start [droplet-client](#Configure and Start droplet-client)</td> <td></td></tr> <tr><td>Set retrieval price and payment address</td> <td>Storage provider through <code>droplet</code> [set search pending order] (#retrieve pending order)</td> <td></td></tr> <tr><td>Submit data retrieval request</td> <td>[Submit data retrieval request] (#submit data retrieval request)</td> <td>After submitting the data retrieval request, the search communication process will start, and the data will be returned in batches according to the agreement and fees will be transferred to the receiving address.</td></tr></tbody></table> <p>💁 <strong>Whether it is a storage deal or a retrieval request, the execution process of the protocol is automatic, and messages will be sent to the chain during the period, so it is necessary to ensure that the messages of both parties to the transaction can be signed normally. There is a necessary <code>fil</code> transfer in the transaction process, and the relevant address needs to have sufficient balance, otherwise the transaction will not be completed.</strong></p> <h2 id="configure-and-start-droplet"><a href="#configure-and-start-droplet" class="header-anchor">#</a> Configure and Start droplet</h2> <h3 id="initialization"><a href="#initialization" class="header-anchor">#</a> Initialization</h3> <ul><li>On-chain mode</li></ul> <p>As a component of the chain service, it cooperates with <code>sophon-auth</code>, <code>venus</code>, <code>sophon-messager</code>, <code>sophon-gateway</code> and other components to provide market services for the <code>miner</code> registered to the chain service.</p> <div class="language- extra-class"><pre class="language-text"><code>./droplet run \
--node-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--auth-url=http://&lt;ip&gt;:&lt;port&gt;\
--gateway-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--messager-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--cs-token=&lt;shared-token&gt; \
--signer-type=&quot;gateway&quot;
</code></pre></div><p>Generated droplet service component configuration reference:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Node</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/192.168.200.151/tcp/3455&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/39812&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
   <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;gateway&quot;</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/45132&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">AuthNode</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;http://127.0.0.1:8989&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>
</code></pre></div><p>💁 *<em><code>shared-token</code> is used to authentication when accessing <code>API</code> of other chain service components. <code>token</code> is managed by <code>sophon-auth</code> and requires <code>admin</code> permission. For details, please refer to <a href="https://sophon.venus-fil.io/intro/join-a-cs.html#for-admins-of-shared-modules" target="_blank" rel="noopener noreferrer">sophon-auth token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></em> *</p> <ul><li>Off-chain mode</li></ul> <p>To start with <code>lotus fullnode</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>./droplet run \
--node-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--cs-token=&lt;token of lotus&gt; \
--signer-type=&quot;lotusnode&quot;
</code></pre></div><p>Generated droplet service component configuration reference:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Node</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/1234&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.Ne3JsfHHhN6BgDtdsvLYfUaRC3eJPH_7KrBsMRBdplc&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
   <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;lotusnode&quot;</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/1234&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.Ne3JsfHHhN6BgDtdsvLYfUaRC3eJPH_7KrBsMRBdplc&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">AuthNode</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
</code></pre></div><p>When using chain service <strong>and</strong> <code>venus-wallet</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>./droplet run \
--auth-url=http://&lt;ip&gt;:&lt;port&gt;\
--node-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--messager-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--cs-token=&lt;token of write-authority&gt; \
--signer-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--signer-token=&lt;token of venus-wallet&gt; \
--signer-type=&quot;wallet&quot;
</code></pre></div><p>Generated droplet service component configuration reference:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Node</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/192.168.200.151/tcp/3455&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/39812&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
   <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;wallet&quot;</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/5678/http&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="token punctuation">.</span>eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIl19<span class="token punctuation">.</span>IVBGlmRW__6g4QGbb1D1Jtr1oy
   MM6Sqs1tj1GDGR5EQ&quot;

<span class="token punctuation">[</span><span class="token table class-name">AuthNode</span><span class="token punctuation">]</span>
   <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;http://127.0.0.1:8989&quot;</span>
   <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>
</code></pre></div><p>💁 <strong>If signature uses an independent <code>venus-wallet</code> component, then configure it as the listening address of <code>venus-wallet</code> and a <code>token</code> with signing permission.</strong></p> <p>To generate <code>venus-wallet</code> <code>token</code> with signing permission:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet auth api-info --perm<span class="token operator">=</span>sign
<span class="token operator">&gt;</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIl19.Vr-OP7RNOozf6XXZuahpk-ZGA7IDa5NJjmU9L_znJ-0:/ip4/127.0/567/tcp
</code></pre></div><p>💁 **After the initialization command is successfully executed, <code>droplet repo</code> will be generated, and it needs to be configured according to the actual environment when using it. **</p> <p>Configuration options will be generated when <code>droplet</code> starts for the first time. The default directory is: <code>~/.droplet/config.toml</code>. Next, we will introduce common configuration options.</p> <h3 id="general-configuration"><a href="#general-configuration" class="header-anchor">#</a> General Configuration</h3> <p>For the description of configuration items of <code>venus-wallet</code>, please refer to <a href="https://github.com/ipfs-force-community/droplet/blob/master/docs/zh/droplet%E9%85%8D%E7%BD%AE%E8%A7%A3%E9%87%8A.md" target="_blank" rel="noopener noreferrer">droplet configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, here we explain the more commonly used configuration items.</p> <p><em>tips:</em> After modifying the configuration file, you need to restart the <code>droplet</code> service:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./droplet run <span class="token operator">&gt;</span> droplet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><blockquote><p>After the <code>repo</code> has been generated, the parameters required for initialization are written into the configuration file, so there is no need to add them for subsequent startups.</p></blockquote> <h4 id="chain-service-configuration"><a href="#chain-service-configuration" class="header-anchor">#</a> Chain service configuration</h4> <ul><li>Including: chain synchronization node, message node, signature node and authentication node.</li></ul> <div class="language-yuml extra-class"><pre class="language-text"><code>[Node]
   Url = &quot;/ip4/192.168.200.21/tcp/3453&quot;
   Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;
[Messager]
   Url = &quot;/ip4/192.168.200.21/tcp/39812&quot;
   Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;
[Signer]
   Type = &quot;gateway&quot;
   Url = &quot;/ip4/192.168.200.21/tcp/45132&quot;
   Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;
[AuthNode]
   Url = &quot;http://192.168.200.21:8989&quot;
   Token = &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;
</code></pre></div><h4 id="api-listener-configuration"><a href="#api-listener-configuration" class="header-anchor">#</a> <code>API</code> listener configuration</h4> <p>The default listening port of <code>droplet</code> is <code>127.0.0.1:41235</code>, in order to support access requests from different networks, the listening address of <code>API</code> needs to be modified:</p> <div class="language-yuml extra-class"><pre class="language-text"><code>[API]
ListenAddress = &quot;/ip4/0.0.0.0/tcp/41235&quot;
</code></pre></div><h4 id="publishmsgperiod-configuration"><a href="#publishmsgperiod-configuration" class="header-anchor">#</a> <code>PublishMsgPeriod</code> configuration</h4> <p>When <code>droplet</code> receives a deal from <code>droplet-client</code>, it will not publish the <code>ClientDealProposal</code> message immediately, but will wait for a certain period of time, which is controlled by the <code>PublishMsgPeriod</code> option in the configuration file, which can be used during testing Setting this to a small value reduces waiting time. The following settings, set the wait time to 10 seconds.</p> <div class="language-yuml extra-class"><pre class="language-text"><code>PublishMsgPeriod = &quot;10s&quot;
</code></pre></div><h4 id="piecestorage-configuration"><a href="#piecestorage-configuration" class="header-anchor">#</a> <code>PieceStorage</code> Configuration</h4> <p>Currently <code>droplet</code> supports two storage modes for <code>Piece</code> data:</p> <ul><li>File system</li> <li>Object storage</li></ul> <div class="language-yuml extra-class"><pre class="language-text"><code>[Piece Storage]
   [[PieceStorage. Fs]]
     Name = &quot;local&quot;
     Enable = true
     Path = &quot;/mnt/pieces&quot;
   [[PieceStorage.S3]]
     Name = &quot;oss&quot;
     Enable = false
     EndPoint = &quot;&quot;
     AccessKey = &quot;&quot;
     SecretKey = &quot;&quot;
     Token = &quot;&quot;
</code></pre></div><p>It can also be configured by command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Local file system storage</span>
./droplet piece-storage add-fs --path<span class="token operator">=</span><span class="token string">&quot;/piece/storage/path&quot;</span> --name<span class="token operator">=</span><span class="token string">&quot;local&quot;</span>

<span class="token comment"># object storage</span>
./droplet piece-storage add-s3 --endpoint<span class="token operator">=</span><span class="token operator">&lt;</span>url<span class="token operator">&gt;</span> --name<span class="token operator">=</span><span class="token string">&quot;oss&quot;</span>
</code></pre></div><h4 id="miners-configuration"><a href="#miners-configuration" class="header-anchor">#</a> <code>Miners</code> Configuration</h4> <p>The miners of the <code>droplet</code> service and the parameters of each miner are configured as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>[[Miners]]
   Addr = &quot;f01000&quot;
   Account = &quot;testuser01&quot;
  
   ConsiderOnlineStorageDeals = true
   Consider OfflineStorageDeals = true
   ConsiderOnlineRetrievalDeals = true
   ConsiderOfflineRetrievalDeals = true
   ConsiderVerifiedStorageDeals = true
   ConsiderUnverifiedStorageDeals = true
   PieceCidBlocklist = []
   ExpectedSealDuration = &quot;24h0m0s&quot;
   MaxDealStartDelay = &quot;336h0m0s&quot;
   PublishMsgPeriod = &quot;1h0m0s&quot;
   MaxDealsPerPublishMsg = 8
   MaxProviderCollateralMultiplier = 2
   Filter = &quot;&quot;
   RetrievalFilter = &quot;&quot;
   TransferPath = &quot;&quot;
   MaxPublishDealsFee = &quot;0 FIL&quot;
   MaxMarketBalanceAddFee = &quot;0 FIL&quot;
   [CommonProviderConfig. RetrievalPricing]
     Strategy = &quot;default&quot;
     [CommonProviderConfig. RetrievalPricing. Default]
       VerifiedDealsFreeTransfer = true
     [CommonProviderConfig. RetrievalPricing. External]
       Path = &quot;&quot;
     [CommonProviderConfig. AddressConfig]
       DisableWorkerFallback = false
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If there are multiple miners, just copy the above configuration. *** If there are many miners, the configuration file will be very long, consider optimizing? ***</p></div> <h2 id="droplet-proxy-libp2p-listener"><a href="#droplet-proxy-libp2p-listener" class="header-anchor">#</a> droplet proxy libp2p listener</h2> <p>Setting <code>droplet</code> as <code>miner</code>'s <code>libp2p</code> listener proxy is to set the entrance of a specific <code>miner</code> market service to the current running <code>droplet</code> instance.</p> <ul><li>Query <code>droplet</code> peer node listening address</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet net listen

/ip4/127.0.0.1/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
/ip4/192.168.19.67/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
/ip6/::1/tcp/49770/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
</code></pre></div><ul><li>set <code>Mutiadrs</code> and <code>peerid</code> of <code>miners</code> to <code>Mutiadrs</code> and <code>peerid</code> of <code>droplet</code></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet actor set-addrs --miner<span class="token operator">=</span>t01041 /ip4/192.168.19.67/tcp/58418
Requested multiaddrs change <span class="token keyword">in</span> message bafy2bzaceceqgxmiledunzjwbajpghzzn4iibvxhoifsrz4q2grzsirgznzdg

./droplet actor set-peer-id --miner<span class="token operator">=</span>f01041 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
   Requested peerid change <span class="token keyword">in</span> message bafy2bzacea4ruzf4hvyezzhjkt6hnzz5tpk7ttuw6jmyoadqasqtujypqitp2
</code></pre></div><ul><li>After waiting for the message to be on-chained, check the agent information of <code>miner</code></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet actor info --miner t01041
peers: 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
addr: /ip4/192.168.19.67/tcp/58418
</code></pre></div><h2 id="storage-ask"><a href="#storage-ask" class="header-anchor">#</a> Storage Ask</h2> <h3 id="storage-deal-ask"><a href="#storage-deal-ask" class="header-anchor">#</a> Storage Deal Ask</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet storage ask <span class="token builtin class-name">set</span> --price<span class="token operator">=</span><span class="token number">0</span>.01fil --verified-price<span class="token operator">=</span><span class="token number">0</span>.02fil --min-piece-size<span class="token operator">=</span>512b --max-piece-size<span class="token operator">=</span>512M t01041
</code></pre></div><p>Pricing information can be checked via the command line tool:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet storage ask get t01041
Price per GiB/Epoch Verified Min. Piece Size <span class="token punctuation">(</span>padded<span class="token punctuation">)</span> Max. Piece Size <span class="token punctuation">(</span>padded<span class="token punctuation">)</span> Expiry <span class="token punctuation">(</span>Epoch<span class="token punctuation">)</span> Expiry <span class="token punctuation">(</span>Appx. Rem. Time<span class="token punctuation">)</span> Seq. No.
<span class="token number">0.01</span> FIL <span class="token number">0.02</span> FIL <span class="token number">512</span> B <span class="token number">521</span> MiB <span class="token number">161256</span> 719h59m0s <span class="token number">0</span>
</code></pre></div><h3 id="retrieve-deal"><a href="#retrieve-deal" class="header-anchor">#</a> Retrieve Deal</h3> <p>The beneficiary address of storage provider should be configured before retrieval.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Miners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">Addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;t01002&quot;</span>
<span class="token key property">RetrievalPaymentAddress</span> <span class="token punctuation">=</span> <span class="token string">&quot;f3umdpich3a7xpm3bgtn4cr3k3w7auck2waw4pk76vye5tqm7zxeaq5yuewy75p63gzc5bhzhmfyhuyltcro4a&quot;</span>
</code></pre></div><p>Set the default ask for miner.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet retrieve ask <span class="token builtin class-name">set</span> f01002
</code></pre></div><p>At the same time, you can also set the price of the data retrieval request, if not set, the default is 0.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet retrieve ask <span class="token builtin class-name">set</span> <span class="token punctuation">\</span>
--price <span class="token number">0</span>.02fil <span class="token punctuation">\</span>
--unseal-price <span class="token number">0</span>.01fil <span class="token punctuation">\</span>
--payment-interval 1MB <span class="token punctuation">\</span>
f01002
</code></pre></div><h2 id="configure-and-start-droplet-client"><a href="#configure-and-start-droplet-client" class="header-anchor">#</a> Configure and Start droplet-client</h2> <p>The normal operation of <code>droplet-client</code> requires synchronization node, signature node (<code>venus fullnode</code> and <code>lotus fullnode</code> can be used as signature nodes), message nodes (<code>venus fullnode</code> and <code>lotus fullnode</code> can be used as message nodes) and <code>droplet</code>, which means it can be configured flexibly, as long as the message can be signed properly and snet to the chain.</p> <p><code>droplet-client</code> needs to be configured with <code>--addr</code> to bind the client’s wallet address, which is used to pay client collateral and retrieval fees.</p> <p>Here are three commonly used startup methods:</p> <ul><li>Access to the <code>Venus</code> chain service</li></ul> <p>The signature <code>API</code> of <code>sophon-gateway</code> can only be accessed with <code>admin</code> permission (for security considerations). It is not recommended to use <code>sophon-gateway</code> for <code>droplet-client</code>. We use the local <code>venus-wallet</code> for sign in this case.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--messager-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>sophon-messager_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--auth-token<span class="token operator">=</span><span class="token operator">&lt;</span>user-signed-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>wallet <span class="token punctuation">\</span>
--signer-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus-wallet_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-toke<span class="token operator">=</span><span class="token operator">&lt;</span>wallet-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><blockquote><p><code>venus-wallet</code> generates <code>token</code> with signature permission. please refer to the above.</p></blockquote> <ul><li>Connect to <code>lotus fullnode</code> and start</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--node-token<span class="token operator">=</span><span class="token operator">&lt;</span>node-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>lotusnode<span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><ul><li>Connect to <code>venus fullnode</code> and start</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--node-token<span class="token operator">=</span><span class="token operator">&lt;</span>node-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>wallet <span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><p>These configuration items can also be set in configuration files, see <a href="https://github.com/ipfs-force-community/droplet/blob/master/docs/zh/droplet-client%E9%85%8D%E7%BD%AE%E8%A7%A3%E9%87%8A.md" target="_blank" rel="noopener noreferrer">droplet-client configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="storage-deal"><a href="#storage-deal" class="header-anchor">#</a> Storage Deal</h2> <h3 id="import-the-data-to-be-stored"><a href="#import-the-data-to-be-stored" class="header-anchor">#</a> Import the data to be stored</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client data <span class="token function">import</span> <span class="token operator">&lt;</span>file path<span class="token operator">&gt;</span>
Import <span class="token number">1642491708527303001</span>, Root bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja
</code></pre></div><h3 id="choose-storage-provider"><a href="#choose-storage-provider" class="header-anchor">#</a> Choose Storage Provider</h3> <p>Use <code>droplet-client</code> to query <code>miner</code> storage ask information:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client storage asks query f01041
Ask: t01041
Price per GiB: <span class="token number">0.02</span> FIL
Verified Price per GiB: <span class="token number">0.01</span> FIL
Max Piece size: <span class="token number">8</span> MiB
Min Piece size: <span class="token number">512</span> B
</code></pre></div><h3 id="initiate-storage-deal"><a href="#initiate-storage-deal" class="header-anchor">#</a> Initiate Storage Deal</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>/droplet-client storage deals init
<span class="token comment"># Enter the cid of the data to be stored, `./droplet-client data local`command to view</span>
Data CID <span class="token punctuation">(</span>from lotus client <span class="token function">import</span><span class="token punctuation">)</span>: bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja
<span class="token punctuation">..</span> calculating data size
PieceCid: baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai PayLoadSize: <span class="token number">809</span> PieceSize: <span class="token number">1024</span>
<span class="token comment"># Enter the data storage period</span>
Deal duration <span class="token punctuation">(</span>days<span class="token punctuation">)</span>: <span class="token number">180</span>
Miner Addresses <span class="token punctuation">(</span>f0<span class="token punctuation">..</span> f0<span class="token punctuation">..</span><span class="token punctuation">)</span>, none to find: t01041
<span class="token punctuation">..</span> querying miner asks
-----
Proposing from t16qnfduxzpneb2m3rbdasvhgk7rmmo32zpiypkaq
Balance: <span class="token number">9499.999999856612207905</span> FIL
Piece size: 1KiB <span class="token punctuation">(</span>Payload size: 809B<span class="token punctuation">)</span>
Duration: 4320h0m0s
Total price: ~0.0098876953124352 FIL <span class="token punctuation">(</span><span class="token number">0.000000019073486328</span> FIL per epoch<span class="token punctuation">)</span>
Verified: <span class="token boolean">false</span>
<span class="token comment"># Confirm whether to accept the order price</span>
Accept <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token punctuation">..</span> executing
Deal <span class="token punctuation">(</span>t01051<span class="token punctuation">)</span> CID: bafyreihiln2ha6eaaos7kuhwpnvjvjlxmjnpsklym6hhucu2z776bf2or4
</code></pre></div><p>Then wait for the dael message to be sent to the chain and the storage provider to complete the data sealing.</p> <p><code>droplet-client</code> view daels:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid DealId Provider State On Chain? Slashed? PieceCID Size Price Duration Verified
<span class="token punctuation">..</span>.76bf2or4 <span class="token number">0</span> t01051 StorageDealCheckForAcceptance N N <span class="token punctuation">..</span>.dvowdiai <span class="token number">1016</span> B <span class="token number">0.00992212295525724</span> FIL <span class="token number">520205</span> <span class="token boolean">false</span>
   Message: Provider state: StorageDealPublish
</code></pre></div><h3 id="offline-storage-deal"><a href="#offline-storage-deal" class="header-anchor">#</a> Offline Storage Deal</h3> <ol><li>Import storage deal file</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client data <span class="token function">import</span> ./README.md
Import <span class="token number">1642643014364955003</span>, Root bafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c
</code></pre></div><ol start="2"><li>Convert to CAR file</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client data generate-car ./README.md ./readme.md.car
</code></pre></div><ol start="3"><li>Calculate the <code>CID</code> and <code>Piece size</code> of the CAR file</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client data commP ./readme.md.car
CID: baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq
Piece size: <span class="token number">3.969</span> KiB
</code></pre></div><ol start="4"><li>Initiate a deal</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client storage deals init <span class="token punctuation">\</span>
--manual-piece-cid<span class="token operator">=</span>baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq <span class="token punctuation">\</span>
--manual-piece-size<span class="token operator">=</span><span class="token number">4064</span> <span class="token punctuation">\</span>
bafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c <span class="token punctuation">\</span>
f01051<span class="token punctuation">\</span>
<span class="token number">0</span>.01fil <span class="token punctuation">\</span>
<span class="token number">518400</span>
bafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm
</code></pre></div><ul><li><code>manual-piece-cid</code>: <code>CID</code> output after executing <code>data commP</code> in step 3</li> <li><code>manual-piece-size</code>: <code>Piece size</code> output after executing <code>data commP</code> in step 3. It should be noted that when using this parameter, this value needs to be converted into the size of <code>byte</code>, here The size converted to byte for 3.969kib is 4064.
The next four parameters are:</li> <li>The <code>Root</code> entered after executing the <code>import</code> command in the first step</li> <li>miner ID</li> <li>Negotiate to pay <code>0.01fil</code> for the order, **this value must be greater than the minimum value in <code>storage ask</code> set by miner, otherwise the request will be rejected.</li> <li>Contract period, must be greater than or equal to 180 days, this value also needs to be replaced by epoch, each epoch=30 seconds, in the example: 518400 = 180 days.</li></ul> <p>The final output <code>bafyreidfs2w7lxacq6zpqck7q4zimyitidxyahojf7dbbuz5zr7irdlmqa</code> is the proposed CID.
Like online deals, you can check the deal information through the droplet-client at this time, and the final status of the order will stop at <code>StorageDealWaitingForData</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid DealId Provider State On Chain? Slashed? PieceCID Size Price Duration Verified
<span class="token punctuation">..</span>.s7r6hftm0 t01051 StorageDealCheckForAcceptance N N <span class="token punctuation">..</span>. u7o3d6mq <span class="token number">3.969</span> KiB <span class="token number">5196.63</span> FIL <span class="token number">519663</span> <span class="token boolean">false</span>
   Message: Provider state: StorageDealWaitingForData
</code></pre></div><p>💁 <strong>If <code>droplet-client</code> shows the following content:</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">2022</span>-01-20T12:47:27.966+0800  ERROR storagemarket_impl   clientstates/client_states.go:324   deal bafyreif2k2e4acraxk33z3llwo5gqmk32tfrdj2kocjanojbfbf6vj72vm failed: adding market funds failed: estimating gas used: message execution failed: <span class="token builtin class-name">exit</span> SysErrInsufficientFunds<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre></div><p>It means that the balance in the wallet is insufficient, call the command <code>./droplet-client actor-funds add 100fil</code> and re-execute the command.</p> <ol start="5"><li>Import data files of offline deal
It is necessary to transfer the <code>.car</code> file generated in the previous step 2 to droplet offline, and import the data through the droplet command:</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet storage deal import-data bafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm ./readme.md.car
</code></pre></div><p>Check the status again, the order status is updated to <code>StorageDealPublishing</code>:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid DealId Provider State On Chain? Slashed? PieceCID Size Price Duration Verified
<span class="token punctuation">..</span>.s7r6hftm <span class="token number">0</span> t01051 StorageDealCheckForAcceptance N N <span class="token punctuation">..</span>.u7o3d6mq <span class="token number">3.969</span> KiB <span class="token number">5196.63</span> FIL <span class="token number">519663</span> <span class="token boolean">false</span>
Message: Provider state: StorageDealPublishing
</code></pre></div><p>Finally, wait for the deal status to change to <code>StorageDealAwaitingPreCommit</code>, then the deal data is ready to be sealed.</p> <h2 id="submit-data-retrieval-request"><a href="#submit-data-retrieval-request" class="header-anchor">#</a> Submit Data Retrieval Request</h2> <p>Users can initiate data retrieval request by <code>minerID</code> and <code>Data CID</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client retrieval retrieve --provider t01020 bafk2bzacearla6en6crpouxo72d5lhr3buajbzjippl63bfsd2m7rsyughu42 test.txt
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, Open <span class="token punctuation">(</span>New<span class="token punctuation">)</span>, 0s
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, DealProposed <span class="token punctuation">(</span>WaitForAcceptance<span class="token punctuation">)</span>, 16ms
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, DealAccepted <span class="token punctuation">(</span>Accepted<span class="token punctuation">)</span>, 26ms
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, PaymentChannelSkip <span class="token punctuation">(</span>Ongoing<span class="token punctuation">)</span>, 27ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, Blocks Received <span class="token punctuation">(</span>Ongoing<span class="token punctuation">)</span>, 30ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, AllBlocksReceived <span class="token punctuation">(</span>BlocksComplete<span class="token punctuation">)</span>, 33ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, Complete <span class="token punctuation">(</span>CheckComplete<span class="token punctuation">)</span>, 35ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, CompleteVerified <span class="token punctuation">(</span>Finalizing Blockstore<span class="token punctuation">)</span>, 36ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, BlockstoreFinalized <span class="token punctuation">(</span>Completed<span class="token punctuation">)</span>, 36ms
Success
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipfs-force-community/damocles-docs/edit/main/docs/operation/start.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/operation/market-config.html">
        Droplet config
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.22e6f3d6.js" defer></script><script src="/assets/js/2.d646fae5.js" defer></script><script src="/assets/js/20.e55ae312.js" defer></script>
  </body>
</html>
