<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>快速启用 | 水滴</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/droplet-icon.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-GRVZ8072DQ"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-GRVZ8072DQ');</script>
    <meta name="description" content="水滴，原Venus订单服务，是一个Filecoin存储订单解决方案">
    
    <link rel="preload" href="/assets/css/0.styles.72e9161a.css" as="style"><link rel="preload" href="/assets/js/app.3b420fac.js" as="script"><link rel="preload" href="/assets/js/2.d646fae5.js" as="script"><link rel="preload" href="/assets/js/40.eb08e8b4.js" as="script"><link rel="prefetch" href="/assets/js/10.54d869d8.js"><link rel="prefetch" href="/assets/js/11.0709d827.js"><link rel="prefetch" href="/assets/js/12.1067bf79.js"><link rel="prefetch" href="/assets/js/13.79dca4c5.js"><link rel="prefetch" href="/assets/js/14.ccd12171.js"><link rel="prefetch" href="/assets/js/15.cfd4f0ef.js"><link rel="prefetch" href="/assets/js/16.0655211a.js"><link rel="prefetch" href="/assets/js/17.b592e31e.js"><link rel="prefetch" href="/assets/js/18.dd25ebca.js"><link rel="prefetch" href="/assets/js/19.ae250042.js"><link rel="prefetch" href="/assets/js/20.e55ae312.js"><link rel="prefetch" href="/assets/js/21.8ec14afd.js"><link rel="prefetch" href="/assets/js/22.20cd45db.js"><link rel="prefetch" href="/assets/js/23.b96f8066.js"><link rel="prefetch" href="/assets/js/24.98c32c85.js"><link rel="prefetch" href="/assets/js/25.bc845610.js"><link rel="prefetch" href="/assets/js/26.c6900ae9.js"><link rel="prefetch" href="/assets/js/27.40422914.js"><link rel="prefetch" href="/assets/js/28.f85f8f1e.js"><link rel="prefetch" href="/assets/js/29.111516fb.js"><link rel="prefetch" href="/assets/js/3.4f172ebf.js"><link rel="prefetch" href="/assets/js/30.f033c8be.js"><link rel="prefetch" href="/assets/js/31.4d803608.js"><link rel="prefetch" href="/assets/js/32.195b1e04.js"><link rel="prefetch" href="/assets/js/33.e36813ef.js"><link rel="prefetch" href="/assets/js/34.31db2e2c.js"><link rel="prefetch" href="/assets/js/35.48bf0c09.js"><link rel="prefetch" href="/assets/js/36.5e631563.js"><link rel="prefetch" href="/assets/js/37.268ad578.js"><link rel="prefetch" href="/assets/js/38.29313c11.js"><link rel="prefetch" href="/assets/js/39.6ffc3ac2.js"><link rel="prefetch" href="/assets/js/4.ee54e947.js"><link rel="prefetch" href="/assets/js/41.f90b1bb5.js"><link rel="prefetch" href="/assets/js/5.b5bd5abf.js"><link rel="prefetch" href="/assets/js/6.0c2827f1.js"><link rel="prefetch" href="/assets/js/7.fc8c7bc4.js"><link rel="prefetch" href="/assets/js/8.9147db7e.js"><link rel="prefetch" href="/assets/js/9.5a86ab25.js">
    <link rel="stylesheet" href="/assets/css/0.styles.72e9161a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/droplet-icon.png" alt="水滴" class="logo"> <span class="site-name can-hide">水滴</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  功能介绍
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link router-link-active">
  部署/运维
</a></div><div class="nav-item"><a href="/zh/developer/" class="nav-link">
  研发/设计
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/quick_start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  功能介绍
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link router-link-active">
  部署/运维
</a></div><div class="nav-item"><a href="/zh/developer/" class="nav-link">
  研发/设计
</a></div><div class="nav-item"><a href="/zh/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/quick_start.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>部署</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/quick_start.html" aria-current="page" class="active sidebar-link">快速启用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/operation/quick_start.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/zh/operation/quick_start.html#droplet" class="sidebar-link">droplet</a></li><li class="sidebar-sub-header"><a href="/zh/operation/quick_start.html#droplet-client" class="sidebar-link">droplet-client</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>配置</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/market-client-config.html" class="sidebar-link">droplet-client 配置</a></li><li><a href="/zh/operation/market-config.html" class="sidebar-link">droplet 配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/operation/prep-datasets.html" class="sidebar-link">大数据集准备</a></li><li><a href="/zh/operation/migrate-offline-deal.html" class="sidebar-link">迁移离线订单</a></li><li><a href="/zh/operation/batch-deal.html" class="sidebar-link">批量发单</a></li><li><a href="/zh/operation/extend-claim.html" class="sidebar-link">DC 订单续期</a></li><li><a href="/zh/operation/http-retrieval.html" class="sidebar-link">http 检索</a></li><li><a href="/zh/operation/deal-filter.html" class="sidebar-link">订单过滤器</a></li><li><a href="/zh/operation/metrics.html" class="sidebar-link">Metrics 指标</a></li><li><a href="/zh/operation/rebuild-signature.html" class="sidebar-link">签名重构</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="快速启用"><a href="#快速启用" class="header-anchor">#</a> 快速启用</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p><code>droplet</code> 是 <code>venus</code> 系统中的市场服务组件，由两部分组成：<code>droplet</code> 和 <code>droplet-client</code>，通俗理解为市场服务端和客户端。</p> <ul><li><p><code>droplet</code> 的服务对象是存储提供商；</p></li> <li><p><code>droplet-client</code> 的服务对象是有检索需求或存储需求的用户。</p></li></ul> <p><code>droplet</code> 的市场服务分为存储市场和检索市场，其一般流程如下：</p> <ul><li>存储流程：</li></ul> <table><thead><tr><th>阶段</th> <th>步骤</th></tr></thead> <tbody><tr><td>启动 <code>droplet</code> 和 <code>droplet-client</code></td> <td>1. <a href="###droplet%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8">droplet初始化并启动</a> <br>2.  <a href="###droplet-client%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8">droplet-client初始化并启动</a></td></tr> <tr><td>代理 <code>miners</code> 的 <code>libp2p</code> 监听服务</td> <td>3. <a href="###%E8%AE%BE%E7%BD%AEdroplet%E4%BF%A1%E6%81%AF%E5%88%B0%E7%BD%91%E7%BB%9C">设置droplet信息到网络</a></td></tr> <tr><td>为 <code>miners</code> 挂单</td> <td>4. <a href="####%E5%AD%98%E5%82%A8%E6%8C%82%E5%8D%95">存储挂单</a></td></tr> <tr><td>指定 <code>miner</code> 发单</td> <td>5. <a href="###%E5%AD%98%E5%82%A8%E8%AE%A2%E5%8D%95%EF%BC%88%E5%8F%91%E5%8D%95%EF%BC%89">存储发单</a></td></tr></tbody></table> <p>发单之后，需要一定时间执行订单交易流程，订单被确认后，存储提供商对订单中数据进行封装并提交证明，<code>droplet</code> 负责跟踪订单状态。</p> <ul><li>检索流程：</li></ul> <table><thead><tr><th>阶段</th> <th>步骤</th></tr></thead> <tbody><tr><td>启动 <code>droplet</code> 和 <code>droplet-client</code></td> <td>1. <a href="###droplet%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8">droplet初始化并启动</a> <br>2.  <a href="###droplet-client%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B9%B6%E5%90%AF%E5%8A%A8">droplet-client初始化并启动</a></td></tr> <tr><td>设置检索价格及收款地址</td> <td>3. 存储供应商通过 <code>droplet</code> <a href="####%E6%A3%80%E7%B4%A2%E6%8C%82%E5%8D%95">检索挂单</a></td></tr> <tr><td>提交数据检索订单</td> <td>4. <a href="#%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2%E8%AE%A2%E5%8D%95">提交数据检索订单</a></td></tr></tbody></table> <p>提交数据检索订单之后，开始执行检索交流流程，会按照协议分批次回传数据并将所需费用转给收款地址</p> <p>💁 <strong>无论是存储交易还是检索交易，其协议的执行过程都是自动的，期间会发送消息上链，故需保证交易双方的消息都可以正常签名。交易过程存在必要的 <code>fil</code> 流转，相关地址需要有足够的余额，否则交易将无法达成。</strong></p> <h2 id="droplet"><a href="#droplet" class="header-anchor">#</a> droplet</h2> <h3 id="droplet初始化并启动"><a href="#droplet初始化并启动" class="header-anchor">#</a> droplet初始化并启动</h3> <h4 id="gateway签名模式"><a href="#gateway签名模式" class="header-anchor">#</a> gateway签名模式</h4> <p><code>sophon-gateway</code>作为中转，会找链接<code>sophon-gateway</code>的wallet进行签名。
配合<code>sophon-auth</code>、<code>venus</code>、 <code>sophon-messager</code>、<code>sophon-gateway</code>等链服务组件一起为注册到链服务的 <code>miner</code> 提供市场服务。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>./droplet run <span class="token punctuation">\</span>
--cs-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--cs-token<span class="token operator">=</span><span class="token operator">&lt;</span>shared-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span><span class="token string">&quot;gateway&quot;</span> <span class="token punctuation">\</span>
--gateway-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre></div><p>生成的服务组件配置参考:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">ChainService</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span>  <span class="token string">&quot;/ip4/192.168.200.21/tcp/45132&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
  <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;gateway&quot;</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/45132&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>
</code></pre></div><p>💁 <strong><code>shared-token</code> 是用于访问其他链服务组件 <code>API</code> 时的权限验证，由 <code>sophon-auth</code> 管理，需要 <code>admin</code> 权限。具体请参考 <a href="https://github.com/filecoin-project/venus-docs/blob/master/docs/zh/cs/deploy-a-cs.md#user%E5%8F%8Atoken%E7%94%9F%E6%88%90" target="_blank" rel="noopener noreferrer">sophon-auth token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <p>💁 <strong>如果链服务组件没有<a href="https://github.com/ipfs-force-community/sophon-gateway/blob/master/docs/zh/%E5%BF%AB%E9%80%9F%E5%90%AF%E7%94%A8.md#%E4%BD%BF%E7%94%A8-gateway-%E4%BB%A3%E7%90%86%E5%AF%B9%E5%85%B6%E4%BB%96%E7%BA%BF%E4%B8%8A%E7%BB%84%E4%BB%B6%E7%9A%84%E8%AF%B7%E6%B1%82" target="_blank" rel="noopener noreferrer">设置统一的入口<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的话，可以配置文件或者通过命令行 flag 单独设置每一个链服务组件的 Url 和 Token 。具体请参考 <a href="https://github.com/filecoin-project/venus-docs/blob/master/docs/zh/cs/deploy-a-cs.md#user%E5%8F%8Atoken%E7%94%9F%E6%88%90" target="_blank" rel="noopener noreferrer">sophon-auth token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></strong></p> <h5 id="单独为每个链服务组件设置-url-和-token"><a href="#单独为每个链服务组件设置-url-和-token" class="header-anchor">#</a> 单独为每个链服务组件设置 Url 和 Token</h5> <div class="language-sh extra-class"><pre class="language-sh"><code>./droplet run <span class="token punctuation">\</span>
--auth-url<span class="token operator">=</span>http://<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--messager-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--cs-token<span class="token operator">=</span><span class="token operator">&lt;</span>shared-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span><span class="token string">&quot;gateway&quot;</span> <span class="token punctuation">\</span>
--gateway-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span>
</code></pre></div><p>生成的服务组件配置参考:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">ChainService</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span>  <span class="token string">&quot;&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;</span>
<span class="token punctuation">[</span><span class="token table class-name">Node</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/192.168.200.151/tcp/3455&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/39812&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">AuthNode</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;http://127.0.0.1:8989&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
  <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;gateway&quot;</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/45132&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoic2hhcmVkLXRva2VuIiwicGVybSI6ImFkbWluIiwiZXh0IjoiIn0.aARqJ_7FSe1KakkBhWlFvsYm-xBLAXBnl9SvTfqsVe8&quot;</span>

</code></pre></div><h4 id="venus-wallet-签名模式"><a href="#venus-wallet-签名模式" class="header-anchor">#</a> <code>venus-wallet</code> 签名模式</h4> <p>💁 <strong>签名用独立的<code>venus-wallet</code>组件，则配置为 <code>venus-wallet</code>的监听地址及具有签名权限的 <code>token</code>.</strong></p> <p><code>venus-wallet</code> 生成具有签名权限的 <code>token</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ./venus-wallet auth api-info --perm<span class="token operator">=</span>sign
<span class="token operator">&gt;</span> eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIl19.Vr-OP7RNOozf6XXZuahpk-ZGA7IDa5NJjmU9L_znJ-0:/ip4/127.0.0.1/tcp/5678/http
</code></pre></div><p>初始化并启动</p> <div class="language- extra-class"><pre class="language-text"><code>./droplet run \
--cs-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--cs-token=&lt;shared-token&gt; \
--signer-type=&quot;wallet&quot; \
--signer-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--signer-token=&lt;token of venus-wallet&gt; 
</code></pre></div><p>生成的服务组件配置参考:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">ChainService</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span>  <span class="token string">&quot;/ip4/192.168.200.21/tcp/45132&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiemwiLCJwZXJtIjoiYWRtaW4iLCJleHQiOiIifQ.3u-PInSUmX-8f6Z971M7JBCHYgFVQrvwUjJfFY03ouQ&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
  <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;wallet&quot;</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/5678/http&quot;</span>
  <span class="token comment"># wallet生成的token</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIl19.IVBGlmRW__6g4QGbb1D1Jtr1oyMM6Sqs1tj1GDGR5EQ&quot;</span>
</code></pre></div><h4 id="链接lotus启动"><a href="#链接lotus启动" class="header-anchor">#</a> 链接lotus启动</h4> <p>配合 <code>lotus fullnode</code> 的启动方式。</p> <div class="language- extra-class"><pre class="language-text"><code>./droplet run \
--node-url=/ip4/&lt;ip&gt;/tcp/&lt;port&gt; \
--cs-token=&lt;token of lotus&gt; \
--signer-type=&quot;lotusnode&quot;
</code></pre></div><p>生成的服务组件配置参考:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Node</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/1234&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.Ne3JsfHHhN6BgDtdsvLYfUaRC3eJPH_7KrBsMRBdplc&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Messager</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">Signer</span><span class="token punctuation">]</span>
  <span class="token key property">Type</span> <span class="token punctuation">=</span> <span class="token string">&quot;lotusnode&quot;</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;/ip4/127.0.0.1/tcp/1234&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.Ne3JsfHHhN6BgDtdsvLYfUaRC3eJPH_7KrBsMRBdplc&quot;</span>

<span class="token punctuation">[</span><span class="token table class-name">AuthNode</span><span class="token punctuation">]</span>
  <span class="token key property">Url</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
  <span class="token key property">Token</span> <span class="token punctuation">=</span> <span class="token string">&quot;&quot;</span>
</code></pre></div><p>💁 <strong>初始化命令执行成功后将会生成<code>droplet repo</code>,在使用时需根据实际环境配置。</strong></p> <p><code>droplet</code> 首次启动时会生成配置项，默认目录为: <code>~/.droplet/config.toml</code>,可以根据实际情况，对配置文件进行设置。具体配置文件的解释请参考：<a href="/zh/operation/droplet配置解释.html">droplet配置解释</a> <em>tips:</em> 修改完配置文件之后需要重启<code>droplet</code>服务：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">nohup</span> ./droplet run <span class="token operator">&gt;</span> droplet.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span>
</code></pre></div><blockquote><p>已经生成 <code>repo</code> 之后，初始化所需的参数被写入配置文件，故后续启动无需再加。</p></blockquote> <h3 id="添加-miner"><a href="#添加-miner" class="header-anchor">#</a> 添加 miner</h3> <div class="language- extra-class"><pre class="language-text"><code>./droplet actor upsert t01041
</code></pre></div><h3 id="设置droplet信息到网络"><a href="#设置droplet信息到网络" class="header-anchor">#</a> 设置droplet信息到网络</h3> <ul><li>查询 <code>droplet</code> 的对等节点监听地址，获取<code>addrs</code>和<code>peer-id</code>值。</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet net listen

/ip4/127.0.0.1/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
/ip4/192.168.19.67/tcp/58418/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
/ip6/::1/tcp/49770/p2p/12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
</code></pre></div><ul><li>添加一个 <code>miner</code> 到droplet中，用于管理这个节点存储和检索使用</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet actor upsert --account test-1041 f01041
</code></pre></div><p><code>--account</code>可以随意取名，用于标记<code>miner</code>的名称。</p> <ul><li>将 <code>miners</code> 的 <code>Multiaddrs</code> 和 <code>peer-id</code> 设置为 <code>droplet</code> 的 <code>Multiaddrs</code> 和 <code>peer-id</code></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet actor set-addrs --miner<span class="token operator">=</span>t01041 /ip4/192.168.19.67/tcp/58418
Requested multiaddrs change <span class="token keyword">in</span> message bafy2bzaceceqgxmiledunzjwbajpghzzn4iibvxhoifsrz4q2grzsirgznzdg

./droplet actor set-peer-id --miner<span class="token operator">=</span>f01041 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
  Requested peerid change <span class="token keyword">in</span> message bafy2bzacea4ruzf4hvyezzhjkt6hnzz5tpk7ttuw6jmyoadqasqtujypqitp2
</code></pre></div><ul><li>等待消息上链后，查看 <code>miner</code> 的代理信息</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet actor info --miner t01041
peers: 12D3KooWQftXTGFBKooKuyaNkugapUzi4VmjxEKTgkpsNCQufKBK
addr: /ip4/192.168.19.67/tcp/58418
</code></pre></div><h3 id="挂单"><a href="#挂单" class="header-anchor">#</a> 挂单</h3> <h4 id="存储挂单"><a href="#存储挂单" class="header-anchor">#</a> 存储挂单</h4> <p>SP设置订单存储订单的价格和存储文件大小限制等信息。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet storage ask <span class="token builtin class-name">set</span> --price<span class="token operator">=</span><span class="token number">0</span>.01fil --verified-price<span class="token operator">=</span><span class="token number">0</span>.02fil --min-piece-size<span class="token operator">=</span>512b --max-piece-size<span class="token operator">=</span>512M t01041
</code></pre></div><p>可以通过命令行工具检查定价信息：</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet storage ask get t01041
Price per GiB/Epoch  Verified  Min. Piece Size <span class="token punctuation">(</span>padded<span class="token punctuation">)</span>  Max. Piece Size <span class="token punctuation">(</span>padded<span class="token punctuation">)</span>  Expiry <span class="token punctuation">(</span>Epoch<span class="token punctuation">)</span>  Expiry <span class="token punctuation">(</span>Appx. Rem. Time<span class="token punctuation">)</span>  Seq. No.
<span class="token number">0.01</span> FIL             <span class="token number">0.02</span> FIL  <span class="token number">512</span> B                     <span class="token number">521</span> MiB                     <span class="token number">161256</span>          719h59m0s                 <span class="token number">0</span>
</code></pre></div><h4 id="检索挂单"><a href="#检索挂单" class="header-anchor">#</a> 检索挂单</h4> <ul><li>设置收款地址</li></ul> <p>Droplet 中的每一个 miner 都有对应的配置, 其中 <code>RetrievalPaymentAddress</code> 配置的是 miner 的检索收款地址。</p> <p>示例配置如下:</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token table class-name">Miners</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token key property">Addr</span> <span class="token punctuation">=</span> <span class="token string">&quot;t01002&quot;</span>
<span class="token key property">RetrievalPaymentAddress</span> <span class="token punctuation">=</span> <span class="token string">&quot;f3umdpich3a7xpm3bgtn4cr3k3w7auck2waw4pk76vye5tqm7zxeaq5yuewy75p63gzc5bhzhmfyhuyltcro4a&quot;</span>

</code></pre></div><ul><li>设置订单价格</li></ul> <p>设置值默认的订单价格</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet retrieval ask <span class="token builtin class-name">set</span> f01002
</code></pre></div><p>同时，也可以设置数据检索订单的价格，不设置时，默认为0.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet retrieval ask <span class="token builtin class-name">set</span> <span class="token punctuation">\</span>
--price <span class="token number">0</span>.02fil <span class="token punctuation">\</span>
--unseal-price <span class="token number">0</span>.01fil <span class="token punctuation">\</span>
--payment-interval 1MB <span class="token punctuation">\</span>
f01002
</code></pre></div><h2 id="droplet-client"><a href="#droplet-client" class="header-anchor">#</a> droplet-client</h2> <h3 id="droplet-client初始化并启动"><a href="#droplet-client初始化并启动" class="header-anchor">#</a> droplet-client初始化并启动</h3> <p><code>droplet-client</code> 正常运行需要同步节点、签名节点（<code>venus fullnode</code> 和 <code>lotus fullnode</code> 可以作为签名节点）、消息节点（<code>venus fullnode</code> 和 <code>lotus fullnode</code> 可以作为消息节点）及 <code>droplet</code>，故其可以灵活配置，只要保证消息能够正常签名并上链即可。</p> <p><code>droplet-client</code> 需要配置 <code>--addr</code> 用来绑定客户的钱包地址，用于支付客户端抵押和检索费用。</p> <p>这里介绍常用的三种启动方式：</p> <h4 id="接入-venus-链服务-推荐"><a href="#接入-venus-链服务-推荐" class="header-anchor">#</a> 接入 <code>Venus</code> 链服务(推荐)</h4> <p><code>sophon-gateway</code> 的签名 <code>API</code> 只有 <code>admin</code> 权限才能访问（安全考虑），也就是只有链服务组件才能访问，故 <code>droplet-client</code> 无法使用，所以用本地的 <code>venus-wallet</code> 进行签名。</p> <p><code>droplet-client</code>是直连<code>venus-wallet</code>进行本地签名，<code>--addr</code>必须指定<code>venus-wallet</code>有的地址才可以。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span> 
--messager-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>sophon-messager_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--auth-token<span class="token operator">=</span><span class="token operator">&lt;</span>user-read-or-write-permission-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>wallet <span class="token punctuation">\</span>
--signer-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus-wallet_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-toke<span class="token operator">=</span><span class="token operator">&lt;</span>wallet-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><blockquote><p><code>venus-wallet</code> 生成具有签名权限的 <code>token</code> 请参考上文.</p></blockquote> <h4 id="连接-venus-fullnode-启动"><a href="#连接-venus-fullnode-启动" class="header-anchor">#</a> 连接 <code>venus fullnode</code> 启动</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span> 
--node-token<span class="token operator">=</span><span class="token operator">&lt;</span>node-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>wallet <span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><h4 id="连接-lotus-fullnode-启动"><a href="#连接-lotus-fullnode-启动" class="header-anchor">#</a> 连接 <code>lotus fullnode</code> 启动</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client run <span class="token punctuation">\</span>
--node-url<span class="token operator">=</span>/ip4/<span class="token operator">&lt;</span>venus_ip<span class="token operator">&gt;</span>/tcp/<span class="token operator">&lt;</span>port<span class="token operator">&gt;</span> <span class="token punctuation">\</span> 
--node-token<span class="token operator">=</span><span class="token operator">&lt;</span>node-token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
--signer-type<span class="token operator">=</span>lotusnode <span class="token punctuation">\</span>
--addr<span class="token operator">=</span><span class="token operator">&lt;</span>signer address<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
</code></pre></div><p>这些配置项也可以在配置文件中设置，参见<a href="/zh/operation/droplet-client配置解释.html">droplet-client配置</a></p> <h3 id="存储订单-发单"><a href="#存储订单-发单" class="header-anchor">#</a> 存储订单（发单）</h3> <h4 id="在线订单"><a href="#在线订单" class="header-anchor">#</a> 在线订单</h4> <h5 id="_1-导入待存储的数据"><a href="#_1-导入待存储的数据" class="header-anchor">#</a> 1. 导入待存储的数据</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client data <span class="token function">import</span> <span class="token operator">&lt;</span>file path<span class="token operator">&gt;</span>
Import <span class="token number">1642491708527303001</span>, Root bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja
</code></pre></div><h5 id="_2-选择挂单-询价"><a href="#_2-选择挂单-询价" class="header-anchor">#</a> 2. 选择挂单(询价)</h5> <p>测试连通性，使用 <code>droplet-client</code> 来查询 <code>miner</code> 挂单信息：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client storage asks query f01041 
Ask: t01041
Price per GiB: <span class="token number">0.02</span> FIL
Verified Price per GiB: <span class="token number">0.01</span> FIL
Max Piece size: <span class="token number">8</span> MiB
Min Piece size: <span class="token number">512</span> B
</code></pre></div><h5 id="_3-发起存储订单-发单"><a href="#_3-发起存储订单-发单" class="header-anchor">#</a> 3. 发起存储订单（发单）</h5> <div class="language-shell extra-class"><pre class="language-shell"><code>/droplet-client storage deals init
<span class="token comment"># 输入需要存储的数据的cid, `./droplet-client data local`命令查看</span>
Data CID <span class="token punctuation">(</span>from lotus client <span class="token function">import</span><span class="token punctuation">)</span>: bafk2bzacedgv2xqys5ja4gycqipmg543ekxz3tjj6wwfexda352n55ahjldja
<span class="token punctuation">..</span> calculating data size
PieceCid:  baga6ea4seaqpz47j4kqdiixpehmzk3uw5c4cmqvs5iyi7xf7rwkepfhdvowdiai  PayLoadSize: <span class="token number">809</span> PieceSize: <span class="token number">1024</span>
<span class="token comment"># 输入数据存储周期</span>
Deal duration <span class="token punctuation">(</span>days<span class="token punctuation">)</span>: <span class="token number">180</span>
<span class="token comment"># 输入接单的miner id</span>
Miner Addresses <span class="token punctuation">(</span>f0<span class="token punctuation">..</span> f0<span class="token punctuation">..</span><span class="token punctuation">)</span>, none to find: t01041
<span class="token punctuation">..</span> querying miner asks
-----
Proposing from t16qnfduxzpneb2m3rbdasvhgk7rmmo32zpiypkaq
	Balance: <span class="token number">9499.999999856612207905</span> FIL
Piece size: 1KiB <span class="token punctuation">(</span>Payload size: 809B<span class="token punctuation">)</span>
Duration: 4320h0m0s
Total price: ~0.0098876953124352 FIL <span class="token punctuation">(</span><span class="token number">0.000000019073486328</span> FIL per epoch<span class="token punctuation">)</span>
Verified: <span class="token boolean">false</span>
<span class="token comment"># 确认是否接受订单价格</span>
Accept <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token punctuation">..</span> executing
Deal <span class="token punctuation">(</span>t01051<span class="token punctuation">)</span> CID: bafyreihiln2ha6eaaos7kuhwpnvjvjlxmjnpsklym6hhucu2z776bf2or4
</code></pre></div><p>然后等待订单消息上链，以及存储提供商完成数据封装即可。</p> <p><code>droplet-client</code> 查看订单:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid      DealId  Provider  State                          On Chain?  Slashed?  PieceCID     Size    Price                    Duration  Verified
<span class="token punctuation">..</span>.76bf2or4  <span class="token number">0</span>       t01051    StorageDealCheckForAcceptance  N          N         <span class="token punctuation">..</span>.dvowdiai  <span class="token number">1016</span> B  <span class="token number">0.00992212295525724</span> FIL  <span class="token number">520205</span>    <span class="token boolean">false</span>
  Message: Provider state: StorageDealPublish
</code></pre></div><h4 id="离线订单"><a href="#离线订单" class="header-anchor">#</a> 离线订单</h4> <h5 id="_1-导入订单存储文件"><a href="#_1-导入订单存储文件" class="header-anchor">#</a> 1. 导入订单存储文件</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client data <span class="token function">import</span> ./README.md
Import <span class="token number">1642643014364955003</span>, Root bafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c
</code></pre></div><h5 id="_2-转为car文件"><a href="#_2-转为car文件" class="header-anchor">#</a> 2. 转为CAR文件</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client data generate-car ./README.md ./readme.md.car
</code></pre></div><h5 id="_3-计算car文件的cid和piece-size"><a href="#_3-计算car文件的cid和piece-size" class="header-anchor">#</a> 3. 计算CAR文件的<code>CID</code>和<code>Piece size</code></h5> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client data commP ./readme.md.car
CID:  baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq
Piece size:  <span class="token number">3.969</span> KiB
</code></pre></div><h5 id="_4-发起订单"><a href="#_4-发起订单" class="header-anchor">#</a> 4. 发起订单</h5> <div class="language-bash extra-class"><pre class="language-bash"><code>./droplet-client storage deals init <span class="token punctuation">\</span>
--manual-piece-cid<span class="token operator">=</span>baga6ea4seaqfewgysi3n3cjylkbfknr56vbemb2gwjfvpctqtjgpdweu7o3d6mq <span class="token punctuation">\</span>
--manual-piece-size<span class="token operator">=</span><span class="token number">4064</span> <span class="token punctuation">\</span>
bafk2bzaceaf4sallirkt63fqrojz5gaut7akiwxrclcsymqelqad7man3hc2c <span class="token punctuation">\</span>
f01051 <span class="token punctuation">\</span>
<span class="token number">0</span>.01fil <span class="token punctuation">\</span>
<span class="token number">518400</span>
bafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm
</code></pre></div><ul><li><code>manual-piece-cid</code>: 在第3步计执行<code>data commP</code>后输出的<code>CID</code></li> <li><code>manual-piece-size</code>: 在第3步执行<code>data commP</code>后输出的<code>Piece size</code>.需要注意的是, 在使用这个参数时, 这个值需要转换成<code>byte</code>的大小, 在这里为3.969kib转换成byte的大小是4064.
之后4个参数分别是:</li> <li>第一步执行<code>import</code>命令后输入的<code>Root</code></li> <li>矿工ID</li> <li>协商支付订单的费用<code>0.01fil</code>, **这个值必须大于旷工设置的<code>storage ask</code>中的最小值, 不然订单会被拒绝掉.</li> <li>合约周期, 必须大于等于180天, 这个值也需要换成epoch为单位, 每个epoch=30秒, 示例中:518400 = 180天.</li></ul> <p>最后的输出<code>bafyreidfs2w7lxacq6zpqck7q4zimyitidxyahojf7dbbuz5zr7irdlmqa</code>为propose的cid.
线上订单一样, 此时可以通过droplet-client查看deal信息, 订单的最后状态会停止在<code>StorageDealWaitingForData</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid      DealId  Provider  State                          On Chain?        Slashed?  PieceCID     Size       Price                    Duration  Verified  
<span class="token punctuation">..</span>.s7r6hftm  <span class="token number">0</span>       t01051    StorageDealCheckForAcceptance  N                N         <span class="token punctuation">..</span>.u7o3d6mq  <span class="token number">3.969</span> KiB  <span class="token number">5196.63</span> FIL              <span class="token number">519663</span>    <span class="token boolean">false</span>     
  Message: Provider state: StorageDealWaitingForData
</code></pre></div><p>💁 <strong>如果 <code>droplet-client</code> 出现下面的内容:</strong></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">2022</span>-01-20T12:47:27.966+0800	ERROR	storagemarket_impl	clientstates/client_states.go:324	deal bafyreif2k2e4acraxk33z3llwo5gqmk32tfrdj2kocjanojbfbf6vj72vm failed: adding market funds failed: estimating gas used: message execution failed: <span class="token builtin class-name">exit</span> SysErrInsufficientFunds<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre></div><p>说明钱包余额不足,调用命令 <code>./droplet-client actor-funds add --address f0xxx --from f3xxxxxxxxxx 100fil</code> 充值后重新执行命令.</p> <h5 id="_5-导入离线订单的数据文件"><a href="#_5-导入离线订单的数据文件" class="header-anchor">#</a> 5. 导入离线订单的数据文件</h5> <p>需要将之前第2步生成的<code>.car</code>文件线下传输到droplet, 并通过droplet命令导入数据:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet storage deal import-data bafyreiecguaxgtmgcanfco6huni4d6h6zs3w3bznermmiurtdos7r6hftm ./readme.md.car
</code></pre></div><p>再次查看状态, 订单状态更新为<code>StorageDealPublishing</code>:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client storage deals list
DealCid      DealId  Provider  State                          On Chain?        Slashed?  PieceCID     Size       Price                    Duration  Verified  
<span class="token punctuation">..</span>.s7r6hftm  <span class="token number">0</span>       t01051    StorageDealCheckForAcceptance  N                N         <span class="token punctuation">..</span>.u7o3d6mq  <span class="token number">3.969</span> KiB  <span class="token number">5196.63</span> FIL              <span class="token number">519663</span>    <span class="token boolean">false</span>     
Message: Provider state: StorageDealPublishing
</code></pre></div><p>最后等待订单状态变化为<code>StorageDealAwaitingPreCommit</code> 就可以进行订单数据的封装了。</p> <h1 id="提交数据检索订单"><a href="#提交数据检索订单" class="header-anchor">#</a> 提交数据检索订单</h1> <p>用户通过 <code>minerID</code> 和 <code>Data CID</code> 就可以发起数据检索订单</p> <div class="language-shell extra-class"><pre class="language-shell"><code>./droplet-client retrieval retrieve --provider t01020 bafk2bzacearla6en6crpouxo72d5lhr3buajbzjippl63bfsd2m7rsyughu42 test.txt
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, Open <span class="token punctuation">(</span>New<span class="token punctuation">)</span>, 0s
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, DealProposed <span class="token punctuation">(</span>WaitForAcceptance<span class="token punctuation">)</span>, 16ms
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, DealAccepted <span class="token punctuation">(</span>Accepted<span class="token punctuation">)</span>, 26ms
Recv <span class="token number">0</span> B, Paid <span class="token number">0</span> FIL, PaymentChannelSkip <span class="token punctuation">(</span>Ongoing<span class="token punctuation">)</span>, 27ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, BlocksReceived <span class="token punctuation">(</span>Ongoing<span class="token punctuation">)</span>, 30ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, AllBlocksReceived <span class="token punctuation">(</span>BlocksComplete<span class="token punctuation">)</span>, 33ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, Complete <span class="token punctuation">(</span>CheckComplete<span class="token punctuation">)</span>, 35ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, CompleteVerified <span class="token punctuation">(</span>FinalizingBlockstore<span class="token punctuation">)</span>, 36ms
Recv <span class="token number">1.479</span> KiB, Paid <span class="token number">0</span> FIL, BlockstoreFinalized <span class="token punctuation">(</span>Completed<span class="token punctuation">)</span>, 36ms
Success
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ipfs-force-community/damocles-docs/edit/main/docs/zh/operation/quick_start.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/zh/operation/market-client-config.html">
        droplet-client 配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.3b420fac.js" defer></script><script src="/assets/js/2.d646fae5.js" defer></script><script src="/assets/js/40.eb08e8b4.js" defer></script>
  </body>
</html>
